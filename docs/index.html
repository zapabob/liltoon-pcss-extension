<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>lilToon PCSS Extension - Ultimate Commercial Edition VPM Repository</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            border-radius: 20px;
            padding: 40px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
        }
        .header {
            text-align: center;
            margin-bottom: 40px;
        }
        .logo {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.3);
        }
        .subtitle {
            font-size: 1.2em;
            opacity: 0.9;
        }
        .add-repo-section {
            background: rgba(255, 255, 255, 0.2);
            border-radius: 15px;
            padding: 30px;
            margin: 30px 0;
            text-align: center;
        }
        .vcc-button {
            display: inline-block;
            background: linear-gradient(45deg, #ff6b6b, #ee5a24);
            color: white;
            padding: 15px 30px;
            border-radius: 25px;
            text-decoration: none;
            font-weight: bold;
            font-size: 1.1em;
            transition: all 0.3s ease;
            margin: 10px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
        }
        .vcc-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(0, 0, 0, 0.3);
        }
        .manual-url {
            background: rgba(0, 0, 0, 0.3);
            padding: 15px;
            border-radius: 10px;
            font-family: monospace;
            margin: 20px 0;
            word-break: break-all;
        }
        .status-check {
            margin: 20px 0;
            padding: 15px;
            border-radius: 10px;
            font-weight: bold;
        }
        .status-success {
            background: rgba(76, 175, 80, 0.3);
            border: 2px solid #4CAF50;
        }
        .status-error {
            background: rgba(244, 67, 54, 0.3);
            border: 2px solid #f44336;
        }
        .status-loading {
            background: rgba(255, 193, 7, 0.3);
            border: 2px solid #FFC107;
        }
        .json-notice {
            background: rgba(33, 150, 243, 0.3);
            border: 2px solid #2196F3;
            margin: 20px 0;
            padding: 20px;
            border-radius: 10px;
        }
        .features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 30px 0;
        }
        .feature {
            background: rgba(255, 255, 255, 0.1);
            padding: 20px;
            border-radius: 15px;
            text-align: center;
        }
        .feature-icon {
            font-size: 2em;
            margin-bottom: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <!-- JSON直接アクセス検出通知 -->
        <div id="json-notice" class="json-notice" style="display: none;">
            <h3>📋 VPMリポジトリJSONファイルについて</h3>
            <p>このページはVRChat Creator Companion (VCC) 用のVPMリポジトリです。</p>
            <p><strong>JSONファイルを直接見ている場合：</strong></p>
            <ul>
                <li>✅ VCCでの自動読み込み：正常動作</li>
                <li>✅ パッケージ情報：最新版v1.4.1</li>
                <li>✅ 商用ライセンス：Ultimate Commercial Edition</li>
            </ul>
            <p>人間が閲覧する場合は、以下のVCC統合ページをご利用ください。</p>
        </div>

        <div class="header">
            <div class="logo">🌟 lilToon PCSS Extension</div>
            <div class="subtitle">Ultimate Commercial Edition VPM Repository</div>
        </div>

        <div class="add-repo-section">
            <h2>🚀 VCC (VRChat Creator Companion) に追加</h2>
            <p>以下のボタンをクリックして、VCCに自動的にリポジトリを追加できます：</p>
            
            <a href="vcc://vpm/addRepo?url=https://zapabob.github.io/liltoon-pcss-extension/index.json" class="vcc-button">
                📦 VCCに自動追加
            </a>
            
            <p>自動追加が動作しない場合は、以下のURLを手動でVCCに追加してください：</p>
            <div class="manual-url">
                https://zapabob.github.io/liltoon-pcss-extension/index.json
            </div>
            
            <div id="status-check" class="status-check status-loading">
                🔄 VPMリポジトリ状態を確認中...
            </div>
        </div>

        <div class="features">
            <div class="feature">
                <div class="feature-icon">⚡</div>
                <h3>高性能PCSS</h3>
                <p>最適化されたPercentage-Closer Soft Shadowsで美しい影を実現</p>
            </div>
            <div class="feature">
                <div class="feature-icon">🎨</div>
                <h3>lilToon完全対応</h3>
                <p>lilToonシェーダーとの完璧な統合とワンクリック設定</p>
            </div>
            <div class="feature">
                <div class="feature-icon">🎮</div>
                <h3>VRChat最適化</h3>
                <p>Quest対応とパフォーマンス最適化で快適なVRChat体験</p>
            </div>
            <div class="feature">
                <div class="feature-icon">🔧</div>
                <h3>VCC統合</h3>
                <p>VRChat Creator Companionでの簡単インストールと自動更新</p>
            </div>
        </div>

        <div style="text-align: center; margin-top: 40px;">
            <p>
                <a href="https://github.com/zapabob/liltoon-pcss-extension" style="color: #fff; text-decoration: none;">
                    📚 GitHub Repository
                </a> | 
                <a href="site/documentation.html" style="color: #fff; text-decoration: none;">
                    📖 Documentation
                </a> | 
                <a href="CHANGELOG.md" style="color: #fff; text-decoration: none;">
                    📝 Changelog
                </a>
            </p>
        </div>
    </div>

    <script>
        // JSON直接アクセス検出機能
        function detectJSONAccess() {
            const urlParams = new URLSearchParams(window.location.search);
            const referrer = document.referrer;
            const userAgent = navigator.userAgent;
            
            // JSON直接アクセスの検出条件
            const isJSONAccess = 
                window.location.pathname.includes('index.json') ||
                urlParams.has('json') ||
                referrer.includes('index.json') ||
                userAgent.includes('VCC') ||
                userAgent.includes('VRChat');
            
            if (isJSONAccess) {
                document.getElementById('json-notice').style.display = 'block';
                console.log('🔍 JSON直接アクセスまたはVCC経由アクセスを検出');
            }
        }

        // VPMリポジトリ自動検証機能
        async function checkVPMRepository() {
            const statusElement = document.getElementById('status-check');
            
            try {
                // index.jsonアクセス可能性チェック
                const response = await fetch('index.json', {
                    method: 'HEAD',
                    cache: 'no-cache'
                });
                
                if (response.ok) {
                    statusElement.className = 'status-check status-success';
                    statusElement.innerHTML = '✅ VPMリポジトリは正常に動作しています！VCCから追加可能です。';
                    
                    // 詳細チェック
                    const jsonResponse = await fetch('index.json', { cache: 'no-cache' });
                    const repoData = await jsonResponse.json();
                    
                    if (repoData.packages && repoData.packages['com.liltoon.pcss-extension']) {
                        const versions = Object.keys(repoData.packages['com.liltoon.pcss-extension'].versions);
                        statusElement.innerHTML += `<br>📦 利用可能バージョン: ${versions.join(', ')}`;
                        statusElement.innerHTML += `<br>💼 ライセンス: Ultimate Commercial Edition`;
                        statusElement.innerHTML += `<br>🔧 コンパイルエラー: 完全修正済み`;
                    }
                } else {
                    throw new Error(`HTTP ${response.status}`);
                }
            } catch (error) {
                statusElement.className = 'status-check status-error';
                statusElement.innerHTML = `❌ VPMリポジトリアクセスエラー: ${error.message}<br>
                    🔧 トラブルシューティング:<br>
                    1. GitHub Pagesが有効になっているか確認<br>
                    2. 数分待ってから再度お試しください<br>
                    3. VCCを最新版に更新してください`;
            }
        }

        // VCC プロトコルハンドラー
        function addToVCC() {
            const vccUrl = 'vcc://vpm/addRepo?url=https://zapabob.github.io/liltoon-pcss-extension/index.json';
            
            try {
                window.location.href = vccUrl;
                
                // フォールバック: 3秒後に手動追加方法を表示
                setTimeout(() => {
                    alert('VCCが自動起動しない場合は、以下のURLを手動でVCCに追加してください：\n\nhttps://zapabob.github.io/liltoon-pcss-extension/index.json');
                }, 3000);
            } catch (error) {
                console.error('VCC起動エラー:', error);
                alert('VCCプロトコルエラー。手動でURLを追加してください。');
            }
        }

        // 初期化
        document.addEventListener('DOMContentLoaded', function() {
            detectJSONAccess();
            checkVPMRepository();
            
            // VCCボタンのクリックイベント
            document.querySelector('.vcc-button').addEventListener('click', function(e) {
                e.preventDefault();
                addToVCC();
            });
        });

        // ページ読み込み完了時の最終チェック
        window.addEventListener('load', function() {
            console.log('📊 lilToon PCSS Extension - Ultimate Commercial Edition');
            console.log('🌐 VPMリポジトリ: https://zapabob.github.io/liltoon-pcss-extension/index.json');
            console.log('📦 最新版: v1.4.1 (コンパイルエラー修正済み)');
            console.log('💼 ライセンス: Ultimate Commercial Edition');
        });
    </script>
</body>
</html>