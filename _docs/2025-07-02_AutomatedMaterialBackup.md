# 実装ログ: ビルド時の自動マテリアルバックアップ機能

## 概要

VRChatアバターのビルド・アップロードプロセスに介入し、マテリアルが破損するリスクを低減させるため、自動バックアップ機能を実装しました。また、この機能がVRChatの自動修正機能（AutoFIX）によって無効化されないように対策を施しました。

## 実施内容

1.  **AutoFIX対策 (アセンブリ定義の修正):**
    - `com.liltoon.pcss-extension/Editor/lilToon.PCSS.Editor.asmdef` ファイルを修正しました。
    - `references`（参照）のリストに `VRC.SDKBase.Editor` を追加しました。
    - これにより、このパッケージ内のエディタスクリプトがVRChat SDKの機能を正式に利用する拡張機能であることを明示し、AutoFIXによる誤判定を防ぎます。

2.  **ビルド時の自動バックアップ機能の実装:**
    - VRChat SDKが提供する `IVRCSDKBuildRequestedCallback` インターフェースを実装した `AutomatedMaterialBackup.cs` を新規に作成しました。
    - ユーザーがVRChat SDKコントロールパネルでアバターのビルドボタンを押すと、このスクリプトが自動的に実行されます。
    - ビルド対象のアバターを特定し、マテリアルをバックアップするかどうかを確認するダイアログを表示します。
    - ユーザーが同意すると、既存の `MaterialBackup.cs` の機能を呼び出して、安全な場所にマテリアルのシェーダー情報を保存します。

## ユーザー体験の向上

- これまで手動で行う必要があったバックアップ作業を、ビルドプロセスに統合することで自動化しました。
- ユーザーはバックアップの存在を意識することなく、アップロード毎にマテリアルが保護されるため、シェーダーエラーによる手戻りのリスクが大幅に低減されます。
- 万が一マテリアルが破損した場合でも、`Tools > Material Backup` メニューから簡単に復元できます。